language: go
git:
  depth: false
  
go:
  - 1.12.5
go_import_path: github.com/syncromatics/idl-repository

services:
  - docker

sudo: true

before_install:
  - npm install -g github-release-cli
  - env GO111MODULE=on go mod download
  - sudo apt-get --yes install snapd
  - sudo snap install gogitver

before_script:
  - git fetch -tv
  - git fetch origin master:master

script:
  - env GO111MODULE=on PATH=$PATH:/snap/bin make package

after_success:
  - bash <(curl -s https://codecov.io/bash)

deploy:
  provider: script
  skip_cleanup: true
  script: env GO111MODULE=on PATH=$PATH:/snap/bin make publish
  on:
    repo: syncromatics/idl-repository
    branch: master
    tags: false
